<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>INEC Results Portal - Complete Solutions</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'inec-green': '#00A651',
                        'inec-blue': '#0066CC'
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Header -->
    <nav class="bg-inec-green text-white shadow-lg">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <h1 class="text-xl font-bold">INEC Results Portal - Complete Solutions</h1>
                </div>
                <div class="flex items-center space-x-4">
                    <span class="text-sm">Frontend: GitHub Pages | Backend: Vercel</span>
                </div>
            </div>
        </div>
    </nav>

    <div class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8">
        <!-- Hero Section -->
        <div class="text-center mb-12">
            <h1 class="text-4xl font-bold text-gray-900 mb-4">INEC Results Portal</h1>
            <p class="text-xl text-gray-600 mb-8">Complete Implementation of All Three Questions</p>
            
            <!-- Backend Status -->
            <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 max-w-2xl mx-auto mb-8">
                <h2 class="text-lg font-semibold text-blue-900 mb-2">Backend Status</h2>
                <div id="backend-status" class="text-sm">
                    <span class="inline-block w-3 h-3 bg-yellow-400 rounded-full mr-2"></span>
                    Checking connection to Vercel backend...
                </div>
            </div>
        </div>

        <!-- Three Questions -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-12">
            <!-- Question 1 -->
            <div class="bg-white shadow-lg rounded-lg overflow-hidden">
                <div class="bg-inec-blue text-white px-6 py-4">
                    <h2 class="text-xl font-bold">Question 1</h2>
                    <p class="text-blue-100">Individual Polling Unit Results</p>
                </div>
                <div class="p-6">
                    <p class="text-gray-700 mb-4">Display results for any individual polling unit with chained selects.</p>
                    
                    <!-- Question 1 Form -->
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Select LGA</label>
                            <select id="q1-lga" onchange="loadQ1Wards()" class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="">Choose LGA...</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Select Ward</label>
                            <select id="q1-ward" onchange="loadQ1PollingUnits()" class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" disabled>
                                <option value="">Choose Ward...</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Select Polling Unit</label>
                            <select id="q1-polling-unit" onchange="loadQ1Results()" class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" disabled>
                                <option value="">Choose Polling Unit...</option>
                            </select>
                        </div>
                        
                        <button onclick="loadQ1Results()" class="w-full bg-inec-blue text-white px-4 py-2 rounded hover:bg-blue-700 disabled:bg-gray-400" id="q1-submit" disabled>
                            Get Results
                        </button>
                    </div>
                    
                    <!-- Question 1 Results Table -->
                    <div id="q1-results" class="mt-6 hidden">
                        <h3 class="text-lg font-semibold mb-4">Polling Unit Results</h3>
                        <div class="overflow-x-auto">
                            <table class="min-w-full bg-white border border-gray-300">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Party</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Score</th>
                                    </tr>
                                </thead>
                                <tbody id="q1-results-body" class="bg-white divide-y divide-gray-200">
                                </tbody>
                            </table>
                        </div>
                        <div id="q1-total" class="mt-4 text-sm text-gray-600"></div>
                    </div>
                </div>
            </div>

            <!-- Question 2 -->
            <div class="bg-white shadow-lg rounded-lg overflow-hidden">
                <div class="bg-inec-green text-white px-6 py-4">
                    <h2 class="text-xl font-bold">Question 2</h2>
                    <p class="text-green-100">LGA Summed Results</p>
                </div>
                <div class="p-6">
                    <p class="text-gray-700 mb-4">Display summed total results for all polling units under any LGA.</p>
                    
                    <!-- Question 2 Form -->
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Select LGA</label>
                            <select id="q2-lga" onchange="loadQ2Results()" class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500">
                                <option value="">Choose LGA...</option>
                            </select>
                        </div>
                        
                        <button onclick="loadQ2Results()" class="w-full bg-inec-green text-white px-4 py-2 rounded hover:bg-green-700 disabled:bg-gray-400" id="q2-submit" disabled>
                            Get Summed Results
                        </button>
                    </div>
                    
                    <!-- Question 2 Results Table -->
                    <div id="q2-results" class="mt-6 hidden">
                        <h3 class="text-lg font-semibold mb-4">LGA Summed Results</h3>
                        <div class="overflow-x-auto">
                            <table class="min-w-full bg-white border border-gray-300">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Party</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Total Score</th>
                                    </tr>
                                </thead>
                                <tbody id="q2-results-body" class="bg-white divide-y divide-gray-200">
                                </tbody>
                            </table>
                        </div>
                        <div id="q2-total" class="mt-4 text-sm text-gray-600"></div>
                    </div>
                </div>
            </div>

            <!-- Question 3 -->
            <div class="bg-white shadow-lg rounded-lg overflow-hidden">
                <div class="bg-purple-600 text-white px-6 py-4">
                    <h2 class="text-xl font-bold">Question 3</h2>
                    <p class="text-purple-100">Add New Polling Unit Results</p>
                </div>
                <div class="p-6">
                    <p class="text-gray-700 mb-4">Store results for ALL parties for a new polling unit.</p>
                    
                    <!-- Question 3 Form -->
                    <form id="q3-form" onsubmit="submitQ3Results(event)" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Select LGA</label>
                            <select id="q3-lga" onchange="loadQ3Wards()" class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-purple-500">
                                <option value="">Choose LGA...</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Select Ward</label>
                            <select id="q3-ward" onchange="loadQ3PollingUnits()" class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-purple-500" disabled>
                                <option value="">Choose Ward...</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Select Polling Unit</label>
                            <select id="q3-polling-unit" class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-purple-500" disabled>
                                <option value="">Choose Polling Unit...</option>
                            </select>
                        </div>
                        
                        <!-- Party Results Inputs -->
                        <div id="q3-party-inputs" class="space-y-3 hidden">
                            <h4 class="font-medium text-gray-700">Enter Results for Each Party:</h4>
                            <div id="q3-inputs-container"></div>
                        </div>
                        
                        <button type="submit" class="w-full bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700 disabled:bg-gray-400" id="q3-submit" disabled>
                            Add Results
                        </button>
                    </form>
                    
                    <!-- Question 3 Success Message -->
                    <div id="q3-success" class="mt-6 hidden">
                        <div class="bg-green-50 border border-green-200 rounded-md p-4">
                            <h3 class="text-lg font-semibold text-green-800">Results Added Successfully!</h3>
                            <div id="q3-success-details" class="mt-2 text-sm text-green-700"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Test Results -->
        <div id="test-results" class="bg-white shadow-lg rounded-lg p-6">
            <h2 class="text-2xl font-bold mb-4">Test Results</h2>
            <div id="test-output" class="text-gray-500">
                Click on any question above to test the API endpoints.
            </div>
        </div>
    </div>

    <script>
        // Configuration - Update this with your Vercel URL after deployment
        const API_BASE_URL = 'https://inec-results-portal.vercel.app';
        
        // Check backend connection
        async function checkBackendStatus() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/health.php`);
                if (response.ok) {
                    const data = await response.json();
                    document.getElementById('backend-status').innerHTML = 
                        `<span class="inline-block w-3 h-3 bg-green-400 rounded-full mr-2"></span>Connected to Vercel backend (${data.php_version})`;
                    
                    // Load initial data
                    loadLGAs();
                } else {
                    throw new Error('Backend not responding');
                }
            } catch (error) {
                document.getElementById('backend-status').innerHTML = 
                    '<span class="inline-block w-3 h-3 bg-red-400 rounded-full mr-2"></span>Backend connection failed - Check Vercel deployment';
                console.error('Backend error:', error);
            }
        }

        // Load LGAs for all questions
        async function loadLGAs() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/question1.php?action=lgas`);
                const data = await response.json();
                
                if (data.status === 'success') {
                    // Populate all LGA dropdowns
                    populateSelect('q1-lga', data.data);
                    populateSelect('q2-lga', data.data);
                    populateSelect('q3-lga', data.data);
                }
            } catch (error) {
                console.error('Error loading LGAs:', error);
            }
        }

        // Populate select dropdown
        function populateSelect(selectId, data) {
            const select = document.getElementById(selectId);
            select.innerHTML = '<option value="">Choose LGA...</option>';
            
            data.forEach(item => {
                const option = document.createElement('option');
                option.value = item.id;
                option.textContent = item.name;
                select.appendChild(option);
            });
        }

        // Question 1 Functions
        async function loadQ1Wards() {
            const lgaId = document.getElementById('q1-lga').value;
            if (!lgaId) return;
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/question1.php?action=wards&lga_id=${lgaId}`);
                const data = await response.json();
                
                if (data.status === 'success') {
                    const wardSelect = document.getElementById('q1-ward');
                    wardSelect.innerHTML = '<option value="">Choose Ward...</option>';
                    data.data.forEach(ward => {
                        const option = document.createElement('option');
                        option.value = ward.id;
                        option.textContent = ward.name;
                        wardSelect.appendChild(option);
                    });
                    wardSelect.disabled = false;
                    
                    // Reset polling unit
                    document.getElementById('q1-polling-unit').innerHTML = '<option value="">Choose Polling Unit...</option>';
                    document.getElementById('q1-polling-unit').disabled = true;
                    document.getElementById('q1-submit').disabled = true;
                }
            } catch (error) {
                console.error('Error loading wards:', error);
            }
        }

        async function loadQ1PollingUnits() {
            const wardId = document.getElementById('q1-ward').value;
            if (!wardId) return;
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/question1.php?action=polling_units&ward_id=${wardId}`);
                const data = await response.json();
                
                if (data.status === 'success') {
                    const puSelect = document.getElementById('q1-polling-unit');
                    puSelect.innerHTML = '<option value="">Choose Polling Unit...</option>';
                    data.data.forEach(pu => {
                        const option = document.createElement('option');
                        option.value = pu.id;
                        option.textContent = pu.name;
                        puSelect.appendChild(option);
                    });
                    puSelect.disabled = false;
                    document.getElementById('q1-submit').disabled = false;
                }
            } catch (error) {
                console.error('Error loading polling units:', error);
            }
        }

        async function loadQ1Results() {
            const pollingUnitId = document.getElementById('q1-polling-unit').value;
            if (!pollingUnitId) return;
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/question1.php?action=results&polling_unit_id=${pollingUnitId}`);
                const data = await response.json();
                
                if (data.status === 'success') {
                    displayQ1Results(data.data, data.total_votes);
                }
            } catch (error) {
                console.error('Error loading results:', error);
            }
        }

        function displayQ1Results(results, totalVotes) {
            const tbody = document.getElementById('q1-results-body');
            tbody.innerHTML = '';
            
            results.forEach(result => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-4 py-2 text-sm text-gray-900">${result.party}</td>
                    <td class="px-4 py-2 text-sm text-gray-900">${result.score}</td>
                `;
                tbody.appendChild(row);
            });
            
            document.getElementById('q1-total').textContent = `Total Votes: ${totalVotes}`;
            document.getElementById('q1-results').classList.remove('hidden');
        }

        // Question 2 Functions
        async function loadQ2Results() {
            const lgaId = document.getElementById('q2-lga').value;
            if (!lgaId) return;
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/question2.php?action=results&lga_id=${lgaId}`);
                const data = await response.json();
                
                if (data.status === 'success') {
                    displayQ2Results(data.data, data.total_votes);
                }
            } catch (error) {
                console.error('Error loading LGA results:', error);
            }
        }

        function displayQ2Results(results, totalVotes) {
            const tbody = document.getElementById('q2-results-body');
            tbody.innerHTML = '';
            
            results.forEach(result => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-4 py-2 text-sm text-gray-900">${result.party}</td>
                    <td class="px-4 py-2 text-sm text-gray-900">${result.total_score}</td>
                `;
                tbody.appendChild(row);
            });
            
            document.getElementById('q2-total').textContent = `Total Votes: ${totalVotes}`;
            document.getElementById('q2-results').classList.remove('hidden');
        }

        // Question 3 Functions
        async function loadQ3Wards() {
            const lgaId = document.getElementById('q3-lga').value;
            if (!lgaId) return;
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/question3.php?action=wards&lga_id=${lgaId}`);
                const data = await response.json();
                
                if (data.status === 'success') {
                    const wardSelect = document.getElementById('q3-ward');
                    wardSelect.innerHTML = '<option value="">Choose Ward...</option>';
                    data.data.forEach(ward => {
                        const option = document.createElement('option');
                        option.value = ward.id;
                        option.textContent = ward.name;
                        wardSelect.appendChild(option);
                    });
                    wardSelect.disabled = false;
                    
                    // Reset polling unit
                    document.getElementById('q3-polling-unit').innerHTML = '<option value="">Choose Polling Unit...</option>';
                    document.getElementById('q3-polling-unit').disabled = true;
                    document.getElementById('q3-submit').disabled = true;
                }
            } catch (error) {
                console.error('Error loading wards:', error);
            }
        }

        async function loadQ3PollingUnits() {
            const wardId = document.getElementById('q3-ward').value;
            if (!wardId) return;
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/question3.php?action=polling_units&ward_id=${wardId}`);
                const data = await response.json();
                
                if (data.status === 'success') {
                    const puSelect = document.getElementById('q3-polling-unit');
                    puSelect.innerHTML = '<option value="">Choose Polling Unit...</option>';
                    data.data.forEach(pu => {
                        const option = document.createElement('option');
                        option.value = pu.id;
                        option.textContent = pu.name;
                        puSelect.appendChild(option);
                    });
                    puSelect.disabled = false;
                    
                    // Load parties for input form
                    loadQ3Parties();
                }
            } catch (error) {
                console.error('Error loading polling units:', error);
            }
        }

        async function loadQ3Parties() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/question3.php?action=parties`);
                const data = await response.json();
                
                if (data.status === 'success') {
                    const container = document.getElementById('q3-inputs-container');
                    container.innerHTML = '';
                    
                    data.data.forEach(party => {
                        const div = document.createElement('div');
                        div.innerHTML = `
                            <label class="block text-sm font-medium text-gray-700">${party.partyname}</label>
                            <input type="number" min="0" name="party_${party.id}" data-party="${party.partyname}" 
                                   class="mt-1 w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-purple-500" 
                                   placeholder="Enter votes">
                        `;
                        container.appendChild(div);
                    });
                    
                    document.getElementById('q3-party-inputs').classList.remove('hidden');
                    document.getElementById('q3-submit').disabled = false;
                }
            } catch (error) {
                console.error('Error loading parties:', error);
            }
        }

        async function submitQ3Results(event) {
            event.preventDefault();
            
            const pollingUnitId = document.getElementById('q3-polling-unit').value;
            if (!pollingUnitId) return;
            
            // Collect results
            const results = [];
            const inputs = document.querySelectorAll('#q3-inputs-container input');
            inputs.forEach(input => {
                const party = input.dataset.party;
                const score = parseInt(input.value) || 0;
                if (score > 0) {
                    results.push({ party, score });
                }
            });
            
            if (results.length === 0) {
                alert('Please enter at least one result');
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/question3.php?action=add_results`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        polling_unit_id: pollingUnitId,
                        results: results
                    })
                });
                
                const data = await response.json();
                
                if (data.status === 'success') {
                    displayQ3Success(data);
                } else {
                    alert('Error: ' + data.message);
                }
            } catch (error) {
                console.error('Error submitting results:', error);
                alert('Error submitting results');
            }
        }

        function displayQ3Success(data) {
            const details = document.getElementById('q3-success-details');
            details.innerHTML = `
                <p><strong>Polling Unit ID:</strong> ${data.data[0].polling_unit_id}</p>
                <p><strong>Total Parties:</strong> ${data.total_parties}</p>
                <p><strong>Total Votes:</strong> ${data.total_votes}</p>
                <p><strong>Added at:</strong> ${data.data[0].inserted_at}</p>
            `;
            
            document.getElementById('q3-success').classList.remove('hidden');
            
            // Reset form
            document.getElementById('q3-form').reset();
            document.getElementById('q3-party-inputs').classList.add('hidden');
            document.getElementById('q3-submit').disabled = true;
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            checkBackendStatus();
        });
    </script>
</body>
</html>
</html>